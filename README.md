# 股票技术指标计算程序

这是一个将通达信股票技术分析公式转换为Python实现的程序。提供命令行工具和Web API两种使用方式。

## 功能说明

实现了以下技术指标：

1. **支撑位和阻力位计算**
   - 支撑位 = L1 + P1 * 0.5/8
   - 阻力位 = L1 + P1 * 7/8
   - 中线 = (支撑 + 阻力) / 2

2. **趋势线计算**
   - 基于SMA（简单移动平均）和EMA（指数移动平均）计算
   - 趋势线 = EMA(V11, 3)
   - 其中 V11 = 3*SMA1 - 2*SMA2

3. **买卖信号**
   - **买入信号**：趋势线从下向上穿越10
   - **卖出信号**：趋势线从上向下穿越90
   - **超卖区**：趋势线 < 10
   - **超买区**：趋势线 > 90

4. **其他信号**
   - AA/BB条件：多个买入条件组合
   - CC/DD条件：多个卖出条件组合

## 安装依赖

```bash
pip install -r requirements.txt
```

或者手动安装：

```bash
pip install pandas numpy openpyxl flask flask-cors
```

**注意**: 如果只使用命令行工具，可以只安装基础依赖：
```bash
pip install pandas numpy openpyxl
```

## 使用方法

### 1. 准备数据文件

将股票数据保存为Excel文件（.xlsx格式），放在 `data/` 目录下。

数据文件应包含以下列（列名可以是中文或英文）：
- **日期/时间**：交易日期
- **开盘**：开盘价
- **最高**：最高价
- **最低**：最低价
- **收盘**：收盘价
- **成交量**：成交量（可选）

**注意**：程序会自动将日线数据转换为周线或月线数据进行分析。

### 2. 运行程序

#### 计算日线信号（默认）

```bash
python main.py D
```

或者直接运行（默认就是日线）：

```bash
python main.py
```

#### 计算周线信号

```bash
python main.py W
```

#### 计算月线信号

```bash
python main.py M
```

### 3. 周期说明

- **日线 (D)**：使用原始日线数据，不进行转换
- **周线 (W)**：将日线数据转换为周线数据
  - 开盘：周一的开盘价
  - 收盘：周五的收盘价
  - 最高：整周最高价
  - 最低：整周最低价
  - 成交量：整周成交量之和
- **月线 (M)**：将日线数据转换为月线数据
  - 开盘：月初第一个交易日的开盘价
  - 收盘：月末最后一个交易日的收盘价
  - 最高：整月最高价
  - 最低：整月最低价
  - 成交量：整月成交量之和

### 4. 使用自定义数据

修改 `main.py` 中的文件路径：

```python
df = load_stock_data('data/你的数据文件.xlsx')
```

## 输出说明

程序会根据选择的周期输出相应的结果：

1. **数据转换信息**：显示原始日线数据条数和转换后的周期数据条数
2. **关键指标结果**：最近20条数据的支撑、阻力、中线、趋势线等
3. **信号统计**：
   - 买入信号次数
   - 卖出信号次数
   - 超卖区次数
   - 超买区次数
4. **信号位置**：具体的买入和卖出信号出现的位置（包含日期、收盘价、趋势线值）

**注意**：不同周期的信号数量会不同，周线和月线的信号通常比日线少，但信号更稳定。

## 代码结构

- `stock_indicator.py`：核心指标计算类
  - `StockIndicator`：主要计算类
  - `load_stock_data()`：数据加载函数
- `main.py`：主程序入口
- `requirements.txt`：依赖包列表

## 技术指标说明

### 趋势线计算逻辑

```
1. 计算N周期内的最高价(HHV)和最低价(LLV)
2. 计算比率: (收盘价 - LLV) / (HHV - LLV) * 100
3. 第一层SMA: SMA(比率, 5)
4. 第二层SMA: SMA(SMA1, 3)
5. V11 = 3*SMA1 - 2*SMA2
6. 趋势线 = EMA(V11, 3)
```

### 买卖信号

- **买入信号（买）**：当趋势线从 ≤10 向上穿越到 >10 时触发
- **卖出信号（卖）**：当趋势线从 ≥90 向下穿越到 <90 时触发

## 注意事项

1. 确保Excel文件格式正确，包含必需的价格数据
2. 程序会自动识别常见的中文和英文列名
3. 如果数据格式特殊，可能需要调整 `load_stock_data()` 函数
4. 计算结果会保存到Excel文件，可以用Excel打开查看

## 示例输出

程序运行后会显示类似以下内容：

```
============================================================
股票技术指标计算程序
============================================================

[OK] 数据加载成功，共 1260 条记录
[OK] 指标计算完成

信号统计:
买入信号 (买): 40 次
卖出信号 (卖): 21 次
超卖区 (趋势线<10): 98 次
超买区 (趋势线>90): 44 次
```

## 许可证

本项目仅供学习和研究使用。

