# Web界面使用指南

## 概述

股票技术指标分析系统提供了优雅美观的Web界面，用于可视化展示技术指标、买卖信号和回测结果。界面采用现代化设计，支持响应式布局和深色模式。

## 访问方式

1. 启动服务后，在浏览器中访问：
   ```
   http://localhost:5000
   ```
   或
   ```
   http://localhost:5000/login
   ```

2. 系统会自动跳转到登录页面（如果未登录）

3. 登录成功后，可以访问以下页面：
   - **计算指标页面**: `http://localhost:5000/calculate`
   - **回测分析页面**: `http://localhost:5000/backtest`

## 登录系统

### 登录步骤

1. 访问系统首页，会自动跳转到登录页面
2. 输入账号和密码
   - **默认账号**: `admin`（可通过环境变量修改）
   - **默认密码**: 启动时在控制台显示（可通过环境变量设置）
3. 点击"登录"按钮
4. 登录成功后自动跳转到计算指标页面

### 登录提示

- 系统启动时会在控制台打印登录账号和密码
- 可以通过环境变量 `LOGIN_USERNAME` 和 `LOGIN_PASSWORD` 自定义账号密码
- 所有页面和API接口都需要登录后才能访问

## 计算指标页面

### 功能说明

计算指标页面用于查看股票的技术指标和买卖信号。

### 页面布局

1. **头部导航**
   - 系统标题和图标
   - 导航菜单（计算指标、回测分析）
   - 主题切换按钮（浅色/深色模式）
   - 用户名显示
   - 退出登录按钮

2. **参数设置区域**
   - **股票代码**: 输入股票代码（对应data目录下的Excel文件）
   - **周期类型**: 选择日线、周线或月线
   - **买入信号阈值**: 趋势线穿越此值触发买入（默认10）
   - **开始日期**: 可选，指定查询的开始日期
   - **结束日期**: 可选，指定查询的结束日期
   - **计算指标按钮**: 点击后开始计算

3. **统计卡片区域**
   - **总记录数**: 数据总条数
   - **买入信号次数**: 买入信号的总次数
   - **卖出信号次数**: 卖出信号的总次数
   - **超卖区次数**: 趋势线小于10的次数
   - **超买区次数**: 趋势线大于90的次数

4. **趋势线图表**
   - 使用Chart.js绘制的交互式图表
   - 展示收盘价走势
   - 展示趋势线
   - 展示支撑位和阻力位
   - 标记买入和卖出信号点
   - 支持缩放和拖拽

5. **数据表格区域**
   - **买卖信号标签页**: 显示所有买入和卖出信号列表
     - 日期
     - 收盘价
     - 趋势线值
     - 信号类型（买入/卖出）
   - **最近数据标签页**: 显示最近20条关键指标数据
     - 日期
     - 收盘价
     - 支撑位
     - 阻力位
     - 中线
     - 趋势线
     - 买入信号（0/1）
     - 卖出信号（0/1）

### 使用步骤

1. 选择或输入股票代码
2. 选择周期类型（日线/周线/月线）
3. （可选）设置买入信号阈值
4. （可选）设置时间范围
5. 点击"计算指标"按钮
6. 等待计算完成，查看结果

### 图表说明

- **收盘价线**: 蓝色实线，显示股价走势
- **趋势线**: 橙色实线，显示技术指标趋势
- **支撑位**: 绿色虚线
- **阻力位**: 红色虚线
- **买入信号**: 绿色向上箭头标记
- **卖出信号**: 红色向下箭头标记

## 回测分析页面

### 功能说明

回测分析页面用于配置回测参数，执行回测计算，并查看详细的回测结果和交易记录。

### 页面布局

1. **头部导航**（同计算指标页面）

2. **回测参数设置区域**
   - **股票代码**: 输入股票代码
   - **周期类型**: 选择日线、周线或月线
   - **买入信号阈值**: 趋势线穿越此值触发买入（默认10）
   - **开始日期**: 可选，指定回测的开始日期
   - **结束日期**: 可选，指定回测的结束日期
   - **初始资金**: 输入回测的初始资金金额（元）

3. **卖出策略配置区域**
   - **策略选择**: 可多选，必须至少选择一个
     - ☑ 止损策略
     - ☑ 止盈策略
     - ☑ 20均线下方策略（10%收益后触发）
     - ☑ 追踪止损策略
   - **策略关系**: 选择AND或OR
     - **OR**: 任一策略触发即卖出（默认）
     - **AND**: 所有策略都触发才卖出

4. **策略参数配置区域**
   - 根据选中的策略动态显示相应的参数输入框
   - **止损策略参数**:
     - 止损比例（%）：默认5%
   - **止盈策略参数**:
     - 止盈比例（%）：可选，留空表示不设止盈
   - **20均线下方策略参数**:
     - 20均线下方天数：默认3天
     - 最小收益阈值（%）：可选，如10%
   - **追踪止损策略参数**:
     - 追踪止损比例（%）：默认5%

5. **回测结果区域**
   - **总览卡片**:
     - 初始资金
     - 最终资金
     - 总收益（金额和百分比）
     - 年化收益率
     - 交易天数
     - 总交易次数
   - **交易记录表格**:
     - 买入日期
     - 买入价格
     - 卖出日期
     - 卖出价格
     - 持仓数量
     - 收益（金额和百分比）
     - 卖出原因
     - 按卖出日期倒序排列（最新的在前）

### 使用步骤

1. **设置基础参数**
   - 输入股票代码
   - 选择周期类型
   - （可选）设置买入信号阈值
   - （可选）设置时间范围
   - 输入初始资金

2. **选择卖出策略**
   - 勾选要使用的卖出策略（至少选择一个）
   - 选择策略关系（AND/OR）

3. **配置策略参数**
   - 根据选中的策略，填写相应的参数
   - 注意参数的有效范围

4. **执行回测**
   - 点击"开始回测"按钮
   - 等待计算完成

5. **查看结果**
   - 查看总览统计信息
   - 查看详细的交易记录
   - 分析每笔交易的收益和卖出原因

### 卖出策略说明

#### 止损策略
- 当亏损达到指定比例时自动卖出
- 使用日线数据检查，确保不会错过止损点
- 默认止损比例：5%

#### 止盈策略
- 当盈利达到指定比例时自动卖出
- 可选，留空表示不设止盈限制
- 使用日线数据检查，确保不会错过止盈点

#### 20均线下方策略
- 买入后上穿20均线，然后收盘价回落到20均线下方N天，第(N+1)天卖出
- 默认连续天数：3天
- 可选最小收益阈值（如10%），只有收益达到阈值后才触发此策略
- **注意**: 需要数据文件中包含 `MA.MA3` 列（20日均线）

#### 追踪止损策略
- 初始止损点设置为买入价格下方一定幅度（默认5%）
- 随着股价上升，止损点也随之上移，始终保持在最新高点下方相同幅度
- 使用日线数据检查，确保不会错过止损点

### 策略关系说明

- **OR关系**（默认）：
  - 任一策略触发即卖出
  - 适合快速止损或止盈的场景

- **AND关系**：
  - 所有策略都触发才卖出
  - 适合更保守的交易策略

## 界面特性

### 视觉设计

- **现代化UI**: 采用卡片式布局，渐变背景
- **优雅配色**: 使用专业的配色方案
- **响应式设计**: 适配各种屏幕尺寸（桌面、平板、手机）
- **流畅动画**: 平滑的过渡效果和加载动画
- **深色模式**: 支持浅色/深色主题切换

### 交互体验

- **实时反馈**: 加载状态提示，按钮禁用状态
- **数据可视化**: Chart.js图表展示趋势
- **清晰展示**: 表格数据格式化显示，颜色区分涨跌
- **易于操作**: 直观的按钮和表单控件
- **错误提示**: 友好的错误信息提示

### 颜色方案

系统支持两种颜色方案：

- **CN（中国习惯）**: 红涨绿跌（默认）
- **US（美国习惯）**: 绿涨红跌

可通过环境变量 `STOCK_COLOR_SCHEME` 设置，颜色配置会应用到所有收益、收益率等数值显示。

## 技术栈

- **前端框架**: 原生HTML/CSS/JavaScript
- **图表库**: Chart.js 4.4.0
- **后端框架**: Flask
- **样式**: 自定义CSS，采用现代设计规范

## 浏览器兼容性

支持所有现代浏览器：

- ✅ Chrome/Edge（推荐）
- ✅ Firefox
- ✅ Safari
- ✅ Opera

**最低版本要求**:
- Chrome/Edge: 90+
- Firefox: 88+
- Safari: 14+
- Opera: 76+

## 常见问题

### Q: 登录后页面显示空白？

A: 检查浏览器控制台是否有JavaScript错误，确保浏览器版本符合要求。

### Q: 图表不显示？

A: 检查网络连接，确保Chart.js库能正常加载。可以尝试刷新页面。

### Q: 回测结果中没有交易记录？

A: 检查以下几点：
1. 数据文件中是否有买入信号
2. 选中的卖出策略参数是否合理
3. 时间范围是否正确

### Q: 20均线策略没有触发？

A: 检查数据文件中是否包含 `MA.MA3` 列（20日均线），且买入时收盘价必须在20均线下方。

### Q: 如何切换主题？

A: 点击页面右上角的主题切换按钮（🌙/☀️图标）。

### Q: 如何退出登录？

A: 点击页面右上角的"退出"按钮。

## 注意事项

1. **数据文件**: 确保 `data/` 目录下有对应的Excel数据文件
2. **首次加载**: 首次加载可能需要几秒钟，请耐心等待
3. **图表数据**: 图表数据按时间倒序显示（最新在前）
4. **回测参数**: 回测功能需要输入有效的初始资金（大于0）
5. **策略参数**: 注意各策略参数的有效范围
6. **网络连接**: 确保网络连接正常，以便加载Chart.js库
7. **浏览器缓存**: 如果遇到显示问题，可以尝试清除浏览器缓存

## 快捷键

- **无**: 当前版本未实现快捷键功能

## 更新日志

### v1.0.0
- 初始版本发布
- 支持计算指标页面
- 支持回测分析页面
- 支持深色模式
- 支持响应式设计
- 支持多种卖出策略配置

---

如有问题或建议，请查看项目文档或提交Issue。
